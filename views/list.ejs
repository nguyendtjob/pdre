<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://cdn.datatables.net/v/bs4/dt-1.10.16/b-1.5.1/b-html5-1.5.1/b-print-1.5.1/fh-3.1.3/r-2.2.1/rg-1.0.2/sc-1.4.4/sl-1.2.5/datatables.min.js"></script>
<script src="/js/jquery.dataTables.yadcf.js"></script>

<script>
  //Hide the page while Datatable is treating the information
  document.write('<style>body { visibility: hidden; } </style>');

  //Delay function to display the page
  function delay() {
    var secs = 0;
    setTimeout('initFadeIn()', secs);
  }

  //Turn the page visible
  function initFadeIn() {
    jQuery("body").css("visibility","visible");
    jQuery("body").css("display","none");
    jQuery("body").fadeIn(700);
  }
  function format ( d ) {
    var com = '<i>'+d[9]+'</i>';

    return '<i>Comment: '+com+'</i>';
  }


  $(document).ready(function(){
    $('.table-striped thead th').each( function() {
      var sTitle;

      if ( $(this).attr('thname') == "gene_th" ) {
        sTitle =  'Link to the Gene Card';
      } else if ( $(this).attr('thname') == "hla_th" ) {
        sTitle =  'Human leukocyte antigen \nClass II HLA are shown in blue';
      } else if ( $(this).attr('thname') == "freq_th" ){
        sTitle =  'Frequency in Caucasians, based on \n(1) Marsh SGE, Parham P, Barber LD. The HLA Factsbook (Academic Press, 2000) for HLA-A, B, C, and DR\n(2) Colombani J. HLA, Fonctions immunitaires et applications m√©dicales (John Libbey Eurotext, 1993) for HLA-DP and DR';
      } else if ( $(this).attr('thname') == "seq_th" ){
        sTitle =  'The residues modified by the mutation are indicated in red';
      } else
        sTitle = '';
      this.setAttribute( 'title', sTitle );
    } );

    delay();
    //setting the mutation datable
    var mutationTable = $('#mutationTable').DataTable({
      "sDom": '<"top"bl>rt<"bottom"ip><"clear">',
      "scrollX": true,
      "orderCellsTop": true,
      scrollY: '65vh',
      paging: false,
      scrollCollapse: true,
      headerOffset: 102,

      rowsGroup: [0,1],

      "order": [[ 0, "asc" ]],
      "columnDefs": [
        {
          "targets":[0,1,2,3,4,5,6,7,8,9,10],
          "sortable": false
        },
        {
          "targets": [ 8,9 ],
          "visible": false,
          "searchable": true
        },
        { "width": "16%", "targets": [0,1,4,6,7] },
        { "width": "5%", "targets": [2,3,5,10]},
      ]
      }
    );

    $('#mutationTable .oi-chevron-bottom').on('click', function () {
      var tr = $(this).closest('tr');
      var row = mutationTable.row( tr );

      if ( row.child.isShown() ) {
        // This row is already open - close it
        row.child.hide();
        tr.removeClass('shown');
      }
      else {
        // Open this row
        row.child( format(row.data()) ).show();
        tr.addClass('shown');
      }
    } );

    //setting the tumor datatable
    var tumorTable = $('#tumorTable').DataTable({
      "sDom": '<"top"bl>rt<"bottom"ip><"clear">',
      "scrollX": true,
      "orderCellsTop": true,
      scrollY: '65vh',
      paging: false,
      scrollCollapse: true,
      headerOffset: 102,

      rowsGroup: [0, 1],
      "order": [[ 0, "asc" ]],
      "columnDefs": [
        {
          "targets":[0,1,2,3,4,5,6,7,8,9,10],
          "sortable": false
        },
        {
          "targets": [1,8,9 ],
          "visible": false,
          "searchable": true
        },
        { "width": "24%", "targets": [0,4]},
        { "width": "16%", "targets": [6,7]},
        { "width": "5%", "targets": [2,3,5,10]},
      ]
      }
    );

    $('#tumorTable .oi-chevron-bottom').on('click', function () {
      var tr = $(this).closest('tr');
      var row = tumorTable.row( tr );

      if ( row.child.isShown() ) {
        // This row is already open - close it
        row.child.hide();
        tr.removeClass('shown');
      }
      else {
        // Open this row
        row.child( format(row.data()) ).show();
        tr.addClass('shown');
      }
    } );

    //setting the differentiation datatable
    var differentiationTable = $('#differentationTable').DataTable({
      "sDom": '<"top"bl>rt<"bottom"ip><"clear">',
      "scrollX": true,
      "orderCellsTop": true,
      scrollY: '65vh',
      paging: false,
      scrollCollapse: true,
      headerOffset: 102,
      rowsGroup: [0, 1],
      "order": [[ 0, "asc" ]],
      "columnDefs": [
        {
          "targets":[0,1,2,3,4,5,6,7,8,9,10],
          "sortable": false
        },
        {
          "targets": [8,9 ],
          "visible": false,
          "searchable": true
        },
        { "width": "16%", "targets": [0,1,4,6,7] },
        { "width": "5%", "targets": [2,3,5,10]},
        ]
      }
    );

    $('#differentationTable .oi-chevron-bottom').on('click', function () {
      var tr = $(this).closest('tr');
      var row = differentiationTable.row( tr );

      if ( row.child.isShown() ) {
        // This row is already open - close it
        row.child.hide();
        tr.removeClass('shown');
      }
      else {
        // Open this row
        row.child( format(row.data()) ).show();
        tr.addClass('shown');
      }
    } );

    //setting the overexpressed datatable
    var overexpressedTable = $('#overexpressedTable').DataTable({
      "sDom": '<"top"bl>rt<"bottom"ip><"clear">',
      "scrollX": true,
      "orderCellsTop": true,
      scrollY: '65vh',
      paging: false,
      scrollCollapse: true,
      headerOffset: 102,
      rowsGroup: [0, 1],
      "order": [[ 0, "asc" ]],
      "columnDefs": [
        {
          "targets":[0,1,2,3,4,5,6,7,8,9,10],
          "sortable": false
        },
        {
          "targets": [8,9 ],
          "visible": false,
          "searchable": true
        },
        { "width": "16%", "targets": [0,1,4,6,7] },
        { "width": "5%", "targets": [2,3,5,10]},
      ]
      }
    );

    $('#overexpressedTable .oi-chevron-bottom').on('click', function () {
      var tr = $(this).closest('tr');
      var row = overexpressedTable.row( tr );

      if ( row.child.isShown() ) {
        // This row is already open - close it
        row.child.hide();
        tr.removeClass('shown');
      }
      else {
        // Open this row
        row.child( format(row.data()) ).show();
        tr.addClass('shown');
      }
    } );

    //Setting the potential datatable
    var potentialTable = $('#potentialTable').DataTable({
      "sDom": '<"top"bl>rt<"bottom"ip><"clear">',
      "scrollX": true,
      "orderCellsTop": true,
      scrollY: '65vh',
      paging: false,
      scrollCollapse: true,
      "order": [[ 0, "asc" ]],
      "columnDefs": [
        {
          "targets":[0,1,2,3,4,5,6,7,8,9,10],
          "sortable": false
        },
        {
          "targets": [0,1,2, 3, 4, 5, 6, 8,9 ],
          "visible": false,
          "searchable": true
        },
        { "width": "16%", "targets": [0,1,4,6,7] },
        { "width": "5%", "targets": [2,3,5,10]},
      ]
      }
    );


    $('#potentialTable .oi-chevron-bottom').on('click', function () {
      var tr = $(this).closest('tr');
      var row = potentialTable.row( tr );

      if ( row.child.isShown() ) {
        // This row is already open - close it
        row.child.hide();
        tr.removeClass('shown');
      }
      else {
        // Open this row
        row.child( format(row.data()) ).show();
        tr.addClass('shown');
      }
    } );


    //Function when a bootstrap tab is clicked
    $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
      //Adjusting width of the columns for the header for the visible table
      $.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();

      //Adjusting the fixhedheaders
      generalTable.fixedHeader.adjust();
      mutationTable.fixedHeader.adjust();
      tumorTable.fixedHeader.adjust();
      differentiationTable.fixedHeader.adjust();
      overexpressedTable.fixedHeader.adjust();
      potentialTable.fixedHeader.adjust();
    } );

  });

</script>

<br/>

<ul class="nav nav-tabs" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" href="#mutationTab" role="tab" data-toggle="tab">Mutation</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#tumorTab" role="tab" data-toggle="tab">Tumor-specific</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#differentationTab" role="tab" data-toggle="tab">Differentiation</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#overexpressedTab" role="tab" data-toggle="tab">Overexpressed</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#potentialTab" role="tab" data-toggle="tab">Potential</a>
  </li>
</ul>

<div class="tab-content">
  <div role="tabpanel" class="tab-pane active in" id="mutationTab">
    <table id="mutationTable" class="table-striped cell-border" width="100%">
      <thead>
      <tr>
        <th thname="gene_th">Gene/Protein</th>
        <th thname="tumor_th">Tumor</th>
        <th thname="hla_th">HLA</th>
        <th thname="freq_th">HLA %</th>
        <th thname="seq_th">Peptide Sequence</th>
        <th thname="pos_th">Position</th>
        <th thname="stim_th">Lymphocyte Stimulation Method</th>
        <th thname="ref_th">Reference</th>
        <th>Full Reference</th>
        <th>Comment content</th>
        <th>Comment</th>
      </tr>
      </thead>
      <tbody>
      <% mutations.forEach(function(peptide){ %>
      <tr>
        <td><% if(peptide.geneCard) {%>
          <b><a href="<%= peptide.geneCard %>" target="_blank"><%= peptide.gene %></a></b>
          <% } else {%>
          <i><b><%= peptide.gene %></b></i>
          <% } %>
        </td>
        <td><%= peptide.tumor %></td>
        <% if (peptide.hla.charAt(0) == 'D') {%>
        <td><span style="color:blue"><%= peptide.hla %></span></td>
        <% } else { %>
        <td><%= peptide.hla %></td>
        <% } %>
        <td><%= peptide.freq %></td>
        <td><%= peptide.leftSequence %><span style="color:red"><%= peptide.redPart %></span><%= peptide.rightSequence %></td>
        <td><%= peptide.pos %></td>
        <td><%= peptide.stimulation %></td>
        <td><a href="<%= peptide.url %>" target="_blank"><%= peptide.reference %></a></td>
        <td><%= peptide.fullReference %></td>
        <td><%= peptide.comment %></td>
        <td class="comment-cell"><% if(peptide.comment) {%>
          <span class="btn btn-outline-secondary btn-sm oi oi-chevron-bottom"></span>
          <% } %>
        </td>
      </tr>
      <% })%>
      </tbody>
    </table>
  </div>

  <div role="tabpanel" class="tab-pane" id="tumorTab">
    <table id="tumorTable" class="table-striped cell-border" width="100%">
      <thead>
      <tr>
        <th thname="gene_th">Gene/Protein</th>
        <th thname="tumor_th">Tumor</th>
        <th thname="hla_th">HLA</th>
        <th thname="freq_th">HLA %</th>
        <th thname="seq_th">Peptide Sequence</th>
        <th thname="pos_th">Position</th>
        <th thname="stim_th">Lymphocyte Stimulation Method</th>
        <th thname="ref_th">Reference</th>
        <th>Full Reference</th>
        <th>Comment content</th>
        <th>Comment</th>
      </tr>
      </thead>
      <tbody>
      <% tumors.forEach(function(peptide){ %>
      <tr>
        <td><% if(peptide.geneCard) {%>
          <b><a href="<%= peptide.geneCard %>" target="_blank"><%= peptide.gene %></a></b>
          <% } else {%>
          <i><b><%= peptide.gene %></b></i>
          <% } %>
        </td>
        <td></td>
        <% if (peptide.hla.charAt(0) == 'D') {%>
        <td><span style="color:blue"><%= peptide.hla %></span></td>
        <% } else { %>
        <td><%= peptide.hla %></td>
        <% } %>
        <td><%= peptide.freq %></td>
        <td><%= peptide.leftSequence %></td>
        <td><%= peptide.pos %></td>
        <td><%= peptide.stimulation %></td>
        <td><a href="<%= peptide.url %>" target="_blank"><%= peptide.reference %></a></td>
        <td><%= peptide.fullReference %></td>
        <td><%= peptide.comment %></td>
        <td class="comment-cell"><% if(peptide.comment) {%>
          <span class="btn btn-outline-secondary btn-sm oi oi-chevron-bottom"></span>
          <% } %>
        </td>
      </tr>
      <% })%>
      </tbody>
    </table>
  </div>
  <div role="tabpanel" class="tab-pane" id="differentationTab">
    <table id="differentationTable" class="table-striped cell-border" width="100%">
      <thead>
      <tr>
        <th thname="gene_th">Gene/Protein</th>
        <th thname="tumor_th">Tumor</th>
        <th thname="hla_th">HLA</th>
        <th thname="freq_th">HLA %</th>
        <th thname="seq_th">Peptide Sequence</th>
        <th thname="pos_th">Position</th>
        <th thname="stim_th">Lymphocyte Stimulation Method</th>
        <th thname="ref_th">Reference</th>
        <th>Full Reference</th>
        <th>Comment content</th>
        <th>Comment</th>
      </tr>
      </thead>
      <tbody>
      <% differentiations.forEach(function(peptide){ %>
      <tr>
        <td><% if(peptide.geneCard) {%>
          <b><a href="<%= peptide.geneCard %>" target="_blank"><%= peptide.gene %></a></b>
          <% } else {%>
          <i><b><%= peptide.gene %></b></i>
          <% } %>
        </td>
        <td><%= peptide.tumor %></td>
        <% if (peptide.hla.charAt(0) == 'D') {%>
        <td><span style="color:blue"><%= peptide.hla %></span></td>
        <% } else { %>
        <td><%= peptide.hla %></td>
        <% } %>
        <td><%= peptide.freq %></td>
        <td><%= peptide.leftSequence %></td>
        <td><%= peptide.pos %></td>
        <td><%= peptide.stimulation %></td>
        <td><a href="<%= peptide.url %>" target="_blank"><%= peptide.reference %></a></td>
        <td><%= peptide.fullReference %></td>
        <td><%= peptide.comment %></td>
        <td class="comment-cell"><% if(peptide.comment) {%>
          <span class="btn btn-outline-secondary btn-sm oi oi-chevron-bottom"></span>
          <% } %>
        </td>
      </tr>
      <% })%>
      </tbody>
    </table>
  </div>
  <div role="tabpanel" class="tab-pane" id="overexpressedTab">
    <table id="overexpressedTable" class="table-striped cell-border" width="100%">
      <thead>
      <tr>
        <th thname="gene_th">Gene/Protein</th>
        <th thname="tumor_th">Tumor</th>
        <th thname="hla_th">HLA</th>
        <th thname="freq_th">HLA %</th>
        <th thname="seq_th">Peptide Sequence</th>
        <th thname="pos_th">Position</th>
        <th thname="stim_th">Lymphocyte Stimulation Method</th>
        <th thname="ref_th">Reference</th>
        <th>Full Reference</th>
        <th>Comment content</th>
        <th>Comment</th>
      </tr>
      </thead>
      <tbody>
      <% overs.forEach(function(peptide){ %>
      <tr>
        <td><% if(peptide.geneCard) {%>
          <b><a href="<%= peptide.geneCard %>" target="_blank"><%= peptide.gene %></a></b>
          <% } else {%>
          <i><b><%= peptide.gene %></b></i>
          <% } %>
        </td>
        <td><%= peptide.tumor %></td>
        <% if (peptide.hla.charAt(0) == 'D') {%>
        <td><span style="color:blue"><%= peptide.hla %></span></td>
        <% } else { %>
        <td><%= peptide.hla %></td>
        <% } %>
        <td><%= peptide.freq %></td>
        <td><%= peptide.leftSequence %></td>
        <td><%= peptide.pos %></td>
        <td><%= peptide.stimulation %></td>
        <td><a href="<%= peptide.url %>" target="_blank"><%= peptide.reference %></a></td>
        <td><%= peptide.fullReference %></td>
        <td><%= peptide.comment %></td>
        <td class="comment-cell"><% if(peptide.comment) {%>
          <span class="btn btn-outline-secondary btn-sm oi oi-chevron-bottom"></span>
          <% } %>
        </td>
      </tr>
      <% })%>
      </tbody>
    </table>
  </div>
  <div role="tabpanel" class="tab-pane" id="potentialTab">
    <table id="potentialTable" class="table-striped cell-border" width="100%">
      <thead>
      <tr>
        <th thname="gene_th">Gene/Protein</th>
        <th thname="tumor_th">Tumor</th>
        <th thname="hla_th">HLA</th>
        <th thname="freq_th">HLA %</th>
        <th thname="seq_th">Peptide Sequence</th>
        <th thname="pos_th">Position</th>
        <th thname="stim_th">Lymphocyte Stimulation Method</th>
        <th thname="ref_th">Reference</th>
        <th>Full Reference</th>
        <th>Comment content</th>
        <th>Comment</th>
      </tr>
      </thead>
      <tbody>
      <% potentials.forEach(function(peptide){ %>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td><a href="<%= peptide.url ? peptide.url:''%>" target="_blank"><%= peptide.fullReference ? peptide.fullReference:'' %></a></td>
        <td></td>
        <td><%= peptide.comment? peptide.comment:''%></td>
        <td class="comment-cell"><% if(peptide.comment) {%>
          <span class="btn btn-outline-secondary btn-sm oi oi-chevron-bottom"></span>
          <% } %>
        </td>
      </tr>
      <% })%>
      </tbody>
    </table>
  </div>
</div>


<input id="min" style="display:none"><input id="max" style="display:none">



